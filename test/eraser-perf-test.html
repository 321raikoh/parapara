<!DOCTYPE html>
<!-- This Source Code Form is subject to the terms of the Mozilla Public
   - License, v. 2.0. If a copy of the MPL was not distributed with this file,
   - You can obtain one at http://mozilla.org/MPL/2.0/.  -->
<html>
  <head>
    <title>Eraser perf test</title>
    <script type="text/javascript" src="../src/js/compat.js"></script>
    <script type="text/javascript" src="../src/js/eraser.js"></script>
    <script type="text/javascript">
      function init() {
        const maxMoveDist = 30;
        var src = document.getElementById("cloneSource");
        var minX, maxX, minY, maxY;

        console.profile("Erasing");
        for (var a=0; a<5; ++a) {
          // Copy the canvas
          var copy = src.cloneNode(true);
          copy.id = "canvas";
          copy.style.display = "block";
          src.parentNode.appendChild(copy);
          ParaPara.svgRoot = copy;

          // Setup
          var frames = copy.getElementsByClassName("frame");
          currentFrame = frames[frames.length - 1];
          var eraseControls = new ParaPara.EraseControls();
          eraseControls.targetFrame(currentFrame);

          // Get bounds of canvas in screen coords
          if (!minX) {
            var mx = copy.getScreenCTM();
            var pt = ParaPara.svgRoot.createSVGPoint();
            pt.x = 0;
            pt.y = 0;
            var min = pt.matrixTransform(mx);
            pt.x = 300;
            pt.y = 250;
            var max = pt.matrixTransform(mx);
            minX = min.x;
            minY = min.y;
            maxX = max.x;
            maxY = max.y;
          }

          for (var i = 0; i < 150; ++i) {
            // Create mousedown event
            var x = Math.floor(Math.random()*(maxX-minX+1)) + minX;
            var y = Math.floor(Math.random()*(maxY-minY+1)) + minY;
            var e = document.createEvent("MouseEvents");
            e.initMouseEvent("mousedown", true, false,
              window, 1,
              x, y, x, y,
              false, false, false, false,
              0, null);
            copy.dispatchEvent(e);

            // Create mousemove events
            var noMoves = Math.floor(Math.random()*25);
            for (var j = 0; j < noMoves; ++j) {
              var x_diff =
                Math.floor(Math.random()*maxMoveDist*2) - maxMoveDist;
              if (x + x_diff < minX || x + x_diff > maxX)
                x_diff = -x_diff;
              x += x_diff;
              var y_diff =
                Math.floor(Math.random()*maxMoveDist*2) - maxMoveDist;
              if (y + y_diff < minY || y + y_diff > maxY)
                y_diff = -y_diff;
              y += y_diff;
              e.initMouseEvent("mousemove", true, false,
                window, 1,
                x, y, x, y,
                false, false, false, false,
                0, null);
              copy.dispatchEvent(e);
            }

            // Create mouse up event
            e.initMouseEvent("mouseup", true, false,
              window, 1,
              x, y, x, y,
              false, false, false, false,
              0, null);
            copy.dispatchEvent(e);
          }
        }
        console.profileEnd();
      }
      window.addEventListener("load", init, false);
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>
  <body>
    <div class="workspace">
      <svg style="width: 836px; height: 836px;" viewBox="0 0 300 300"
      id="cloneSource" class="canvas" display="none">
        <rect width="100%" height="100%" fill="black"></rect>
        <g id="anim"><g class="frame"><path d="M39.83,97.03 C 40.19,97.03,40.44,96.51,40.90,96.31 41.24,96.17,42.28,95.42,43.06,95.23 44.80,94.82,45.93,94.88,46.65,94.88 47.36,94.88,49.83,94.34,50.95,94.16 52.01,93.99,54.91,94.02,56.69,93.80 58.16,93.62,62.08,93.08,63.51,93.08 64.59,93.08,67.46,92.72,68.18,92.72 68.54,92.72,69.25,92.72,69.61,92.72 69.97,92.72,70.83,92.04,72.48,92.72 73.42,93.11,73.78,94.00,75.71,95.23 76.39,95.67,77.22,96.27,77.87,97.39 78.27,98.08,79.08,98.13,79.66,99.54 80.07,100.54,80.37,101.26,80.74,103.85 80.89,104.91,81.27,106.33,81.45,107.79 82.20,113.85,82.03,115.23,80.38,118.20 77.65,123.10,75.45,124.50,68.54,129.68 65.83,131.71,62.05,133.54,51.67,137.22 47.71,138.62,44.11,139.20,36.60,140.09 34.08,140.39,31.57,140.45,29.78,140.45 26.55,140.45,25.45,140.52,24.40,140.09 23.66,139.78,23.49,138.99,23.32,138.30 22.95,136.73,22.24,136.14,22.24,135.43 22.24,131.84,22.89,131.05,23.68,130.40 24.68,129.58,28.97,127.33,31.22,126.45 33.65,125.51,41.69,124.23,45.21,123.22 48.16,122.38,55.96,120.53,58.85,120.35 61.35,120.20,66.38,120,67.82,120 68.89,120,71.77,120,72.84,120 73.56,120,74.28,120,75.71,120 76.43,120,78.24,120.59,78.58,120.71 80.75,121.47,80.72,122.70,81.10,123.94 81.51,125.32,81.42,126.21,80.38,128.61 79.54,130.53,78.60,133.34,72.12,138.66 69.51,140.80,66.73,142.58,63.87,144.40 57.74,148.30,55.39,149.99,53.82,150.86 49.45,153.28,47.18,154.40,44.13,155.88 36.58,159.56,28.37,161.08,26.55,161.26 24.76,161.44,23.90,161.21,24.40,159.11 24.77,157.55,25.74,155.82,26.91,154.09 29.91,149.62,31.24,147.95,33.73,146.19 39.89,141.85,44.13,141.14,48.08,140.09 60.62,136.77,66.04,135.93,71.05,135.43 84.73,134.04,88.98,133.09,92.58,132.91 95.80,132.75,107.69,131.98,112.32,132.55 115.25,132.92,116.03,133.23,116.62,133.63 118.22,134.71,117.39,136.14,117.34,137.22 117.16,140.82,116.00,142.65,114.83,145.11 111.51,152.07,109.96,154.18,108.37,156.60 106.40,159.60,100.75,165.82,98.32,167.72 95.72,169.76,87.60,174.04,84.68,174.54 77.22,175.82,74.53,175.88,68.54,174.54 66.32,174.05,60.47,170.67,58.49,169.52 56.82,168.54,53.68,165.44,52.75,164.13 51.56,162.49,50.06,162.13,49.52,159.11 49.32,158.05,48.94,157.13,50.23,154.09 50.74,152.90,52.15,151.51,56.33,149.42 59.08,148.05,61.63,147.08,69.25,146.19 77.46,145.24,80.79,144.09,91.14,145.11 92.96,145.29,94.82,145.71,97.60,148.70 98.48,149.65,99.40,151.17,99.76,155.52 99.87,156.95,100.56,159.26,99.40,163.42 98.75,165.73,97.70,168.03,93.30,174.18 91.66,176.46,89.92,178.05,87.20,179.92 78.46,185.92,74.08,186.58,69.97,187.46 60.47,189.50,55.98,189.87,47.00,187.10 39.64,184.83,38.56,182.60,37.32,181.00 34.74,177.70,34.43,175.94,34.80,173.82 35.53,169.69,37.44,167.50,39.47,165.57 42.07,163.10,50.38,158.06,54.18,155.88 58.64,153.32,71.41,149.10,75.35,148.34 78.95,147.66,88.63,146.19,91.86,146.19 94.37,146.19,98.48,146.71,100.83,148.70 101.61,149.36,102.08,150.79,102.27,151.57 102.43,152.27,102.50,153.38,102.27,156.24 102.09,158.41,101.06,160.84,96.88,169.88 95.40,173.08,93.48,176.51,87.55,182.79 85.81,184.64,83.58,186.57,78.58,189.25 76.88,190.17,75.37,190.87,72.12,191.05 71.41,191.09,71.05,191.05,70.69,191.05 69.97,191.05,69.64,190.91,69.25,189.97 68.43,187.98,68.81,186.33,69.25,184.59 70.36,180.23,72.38,178.41,73.56,177.05 77.55,172.45,80.40,170.99,82.53,169.52 85.07,167.76,92.97,165.43,95.81,164.85 98.37,164.33,102.66,163.89,103.70,164.13 104.48,164.32,105.61,166.27,105.86,168.08 106.50,172.72,105.45,178.89,101.55,184.59 97.53,190.47,95.17,191.85,93.30,193.56 91.23,195.45,83.12,200.88,80.02,202.89 77.01,204.84,68.93,208.77,66.38,209.35 64.25,209.83,60.61,209.93,60.28,210.07 59.81,210.26,60.28,210.43,61.00,210.43 L 61.36,210.43 61.72,210.43" pointer-events="none" fill="none" stroke-linecap="round" stroke-width="6" stroke="red" id="bigSwirlyRedLine"></path>
        <path d="M140.31,99.54 C 140.66,99.54,142.10,99.54,143.18,99.54 146.05,99.54,147.84,99.18,149.64,99.18 156.45,99.18,159.33,99.18,162.20,99.18 165.07,99.18,171.88,99.18,174.76,99.18 177.27,99.18,182.29,99.18,183.73,99.18 185.16,99.18,187.67,99.18,188.39,99.18 189.11,99.18,189.47,99.18,189.47,99.54 189.47,99.90,188.66,101.61,188.03,102.41 186.75,104.06,184.17,108.24,182.29,109.95 180.22,111.84,173.32,117.48,171.17,119.28 169.01,121.07,164.01,124.69,162.20,126.10 160.78,127.19,158.37,127.54,156.10,130.04 155.56,130.64,155.02,131.48,155.02,131.84 155.02,132.20,156.45,132.20,157.89,132.20 163.63,132.20,167.22,132.34,171.53,132.20 193.09,131.48,197.72,130.76,215.66,130.76 218.89,130.76,221.77,130.76,227.15,130.76 228.94,130.76,229.91,131.22,229.66,131.48 229.41,131.73,228.56,131.70,228.22,131.84 227.76,132.03,225.69,132.64,224.28,132.91 222.38,133.28,216.74,135.07,214.23,135.78 211.72,136.50,208.32,136.74,200.59,139.73 191.76,143.15,189.01,145.23,186.24,146.55 179.85,149.60,177.75,151.27,174.40,154.09 173.23,155.06,172.85,155.74,171.88,156.60 171.28,157.13,170.73,157.58,169.37,158.75 168.61,159.42,167.99,159.88,167.22,160.55 165.86,161.72,164.68,162.20,164.35,162.34 162.94,162.92,162.37,163.62,161.48,164.85 161.01,165.50,159.71,168.30,158.97,169.16 158.44,169.76,157.32,170.80,156.81,171.31 156.56,171.56,156.29,171.56,156.10,172.03 155.96,172.36,155.74,172.39,155.74,172.75 155.74,173.11,155.38,173.46,155.38,173.82 L 155.38,174.18 155.02,174.18" pointer-events="none" fill="none" stroke-linecap="round" stroke-width="6" stroke="lime" id="underlayedLimeLine"></path>
        <path d="M241.86,85.55
        C 242.22,85.55,242.61,86.20,243.30,86.62
        243.60,86.81,243.84,87.18,244.73,88.42
        245.20,89.07,245.34,89.92,245.81,90.57
        246.11,90.98,246.98,92.65,247.24,93.08
        247.84,94.05,248.64,95.98,249.04,96.67
        249.69,97.79,250.60,99.43,251.19,100.26
        251.66,100.91,252.34,102.73,252.99,103.85
        253.39,104.54,255.36,107.18,256.22,108.15
        257.28,109.36,257.25,110.98,261.24,115.69
        262.22,116.85,262.64,118.52,264.47,120.35
        265.38,121.27,265.94,121.76,267.70,124.30
        268.43,125.37,269.36,126.17,271.29,129.33
        271.96,130.43,272.72,131.12,273.44,132.55
        274.52,134.71,275.05,135.36,275.23,136.14
        275.65,137.89,275.57,138.66,275.95,139.73
        276.98,142.62,277.69,143.34,278.11,144.40
        280.00,149.17,280.78,149.81,280.98,150.50
        281.53,152.51,282.41,152.65,282.41,153.01
        282.41,154.09,282.46,154.61,282.77,154.80
        283.45,155.23,283.29,156.13,283.49,156.60
        283.63,156.93,283.49,157.32,283.49,157.67
        L 283.49,158.03
        283.85,158.03
        283.85,158.39" pointer-events="none" fill="none"
        stroke-linecap="round" stroke-width="3" stroke="purple" id="longThinPurpleLine"></path>
        <path d="M18.30,115.69 C 19.01,115.69,20.09,115.62,21.53,115.69 25.49,115.87,27.27,116.05,29.42,116.05 31.93,116.05,36.24,116.05,37.67,116.05 39.11,116.05,41.26,116.05,41.62,116.05 41.98,116.05,42.34,116.05,42.70,116.05 43.42,116.05,44.24,115.79,44.49,116.05 45.00,116.56,44.49,117.12,44.49,117.48 44.49,119.28,44.40,119.91,43.77,120.71 42.49,122.36,42.31,122.83,41.62,123.58 39.73,125.65,38.85,126.53,37.67,127.89 36.34,129.42,32.98,132.80,31.57,134.35 30.37,135.68,27.80,138.15,27.27,139.01 26.67,139.98,28.38,140.30,29.06,140.09 30.30,139.72,31.47,139.14,35.88,137.22 38.69,135.99,41.58,135.33,47.72,132.91 50.58,131.79,53.11,131.14,62.08,128.61 72.13,125.76,75.25,124.33,78.22,123.58 83.49,122.26,85.37,121.97,86.84,121.79 87.19,121.75,87.13,122.10,86.84,122.51 85.90,123.81,85.69,124.45,85.04,125.38 83.73,127.26,82.09,128.12,79.66,129.68 70.36,135.66,66.70,139.16,61.72,141.88 57.62,144.12,37.69,153.76,33.37,155.88 23.71,160.62,20.85,162.41,18.30,163.77 16.17,164.91,12.81,166.22,12.20,167.36 12.03,167.68,12.20,168.08,13.27,168.08 13.99,168.08,15.01,167.72,18.66,167.36 21.16,167.12,30.53,165.38,34.44,164.49 38.43,163.59,51.89,160.77,67.46,156.60 70.75,155.72,74.63,154.75,82.53,153.37 84.68,152.99,86.01,152.76,85.76,153.01 85.51,153.26,85.02,153.71,84.68,154.09 83.15,155.80,82.95,156.31,81.81,157.32 77.03,161.56,74.81,163.28,72.12,165.21 65.33,170.10,62.93,171.18,60.64,172.39 58.93,173.29,54.86,175.09,54.54,175.26 53.40,175.87,53.13,176.56,53.46,176.69 53.93,176.89,54.80,175.89,56.69,173.82 57.72,172.70,58.49,172.03,59.56,171.31 L 60.64,170.59 60.28,170.23" pointer-events="none" fill="none" stroke-linecap="round" stroke-width="6" stroke="green" id="overlayedGreenLine"></path>
        <path d="M139.59,98.46 C 140.31,98.46,140.66,98.46,141.02,98.46 141.38,98.46,141.85,98.21,142.10,98.46 142.35,98.72,142.46,98.82,142.82,98.82 143.18,98.82,143.54,98.82,143.89,98.82 144.25,98.82,144.61,98.82,144.97,98.82 145.33,98.82,145.69,98.82,146.05,98.82 146.41,98.82,146.77,98.82,147.48,98.82 147.84,98.82,148.20,98.82,148.56,98.82 148.92,98.82,149.28,98.82,149.64,98.82 150,98.82,150.35,98.82,151.43,98.82 151.79,98.82,152.15,98.82,152.51,98.82 152.87,98.82,153.22,98.82,154.30,98.82 155.02,98.82,155.74,98.82,156.10,98.82 156.45,98.82,156.81,98.82,157.17,98.82 157.89,98.82,158.25,98.82,158.61,98.82 158.97,98.82,159.33,98.82,159.68,98.82 160.04,98.82,160.40,98.82,160.76,98.82 161.12,98.82,161.48,98.82,161.84,98.82 162.55,98.82,162.91,98.82,163.27,98.82 163.63,98.82,163.99,98.82,164.35,98.82 164.71,98.82,165.07,98.82,165.43,98.82 165.78,98.82,166.14,98.82,166.50,98.82 167.22,98.82,167.58,98.82,167.94,98.82 168.30,98.82,168.66,98.82,169.01,98.82 169.73,98.82,170.09,98.82,170.45,98.82 170.81,98.82,171.17,98.82,171.53,98.82 171.88,98.82,172.24,98.82,172.60,98.82 172.96,98.82,173.32,98.82,173.68,98.82 174.40,98.82,174.76,98.82,175.11,98.82 175.47,98.82,175.83,98.82,176.19,98.82 176.55,98.82,176.91,98.82,177.27,98.82 177.99,98.82,178.34,98.82,178.70,98.82 179.06,98.82,179.42,98.82,179.78,98.82 180.14,98.82,180.50,98.82,180.86,98.82 181.22,98.82,181.57,98.82,182.29,98.82 182.65,98.82,183.01,98.82,183.37,98.82 183.73,98.82,184.09,98.82,184.44,98.82 184.80,98.82,185.16,98.82,185.52,98.82 186.24,98.82,186.60,98.82,187.32,98.82 187.67,98.82,188.03,98.82,188.39,98.82 L 188.75,98.82 189.11,98.82" pointer-events="none" fill="none" stroke-linecap="round" stroke-width="6" stroke="blue" id="overlayedBlueLine"></path>
        <path d="M35.88,42.84 C 36.24,42.84,36.60,42.84,37.32,42.84 38.03,42.84,38.75,42.84,39.11,42.84 39.47,42.84,40.19,42.84,41.26,42.84 41.98,42.84,42.74,42.51,44.13,42.84 44.91,43.03,45.55,43.38,47.72,43.56 48.44,43.62,49.16,43.56,50.95,43.56 51.31,43.56,52.03,43.56,52.75,43.56 53.46,43.56,53.82,43.56,54.18,43.56 54.54,43.56,54.90,43.56,55.62,43.56 57.05,43.56,57.77,43.56,58.49,43.56 61.00,43.56,61.72,43.56,62.44,43.56 63.87,43.56,64.23,43.56,64.95,43.56 65.66,43.56,66.38,43.56,67.10,43.56 67.46,43.56,67.82,43.56,68.54,43.56 68.89,43.56,69.61,43.56,71.05,43.56 72.84,43.56,73.86,43.73,74.64,43.92 76.73,44.41,77.51,43.92,78.22,43.92 80.38,43.92,81.10,43.92,81.45,43.92 82.89,43.92,83.61,43.92,84.33,43.92 85.40,43.92,85.76,43.92,86.48,43.92 87.91,43.92,88.99,43.92,90.07,43.92 91.86,43.92,92.58,43.92,92.94,43.92 94.01,43.92,95.45,43.92,96.53,43.92 96.88,43.92,97.60,43.92,97.96,43.92 98.32,43.92,99.40,43.92,99.76,43.92 100.47,43.92,101.19,43.92,102.63,43.92 102.99,43.92,103.70,43.92,106.22,43.92 106.93,43.92,108.37,43.95,108.73,43.92 110.90,43.74,111.60,43.56,112.32,43.56 114.11,43.56,115.90,43.20,116.62,43.20 117.34,43.20,117.70,43.20,119.13,43.20 119.85,43.20,120.57,43.20,121.29,43.20 121.65,43.20,121.97,43.02,123.44,42.84 123.80,42.80,124.88,42.84,126.67,42.84 127.03,42.84,127.75,42.84,129.18,42.84 129.90,42.84,130.26,42.84,130.62,42.84 131.33,42.84,131.94,42.68,132.41,42.48 133.07,42.21,133.85,42.48,134.21,42.48 135.28,42.48,135.64,42.48,136.00,42.48 136.72,42.48,137.08,42.48,137.44,42.48 137.79,42.48,138.15,42.48,138.51,42.48 138.87,42.48,139.59,42.48,139.95,42.48 141.02,42.48,142.10,42.48,142.46,42.48 142.82,42.48,143.18,42.48,143.54,42.48 144.25,42.48,144.61,42.48,145.33,42.48 146.05,42.48,146.41,42.48,147.12,42.48 147.48,42.48,147.84,42.48,148.20,42.48 148.56,42.48,148.92,42.48,149.28,42.48 149.64,42.48,150,42.48,150.35,42.48 151.07,42.48,151.43,42.48,151.79,42.48 152.15,42.48,152.51,42.48,152.87,42.48 153.58,42.48,154.30,42.48,155.02,42.48 155.38,42.48,156.10,42.48,156.45,42.48 156.81,42.48,160.04,42.48,161.48,42.48 162.55,42.48,165.79,42.24,166.50,42.12 167.62,41.94,169.73,41.41,170.45,41.41 170.81,41.41,171.17,41.41,171.53,41.41 L 171.88,41.41 172.24,41.41" pointer-events="none" fill="none" stroke-linecap="round" stroke-width="1" stroke="orange" id="reallyThinOrangeLine"></path>
        </g>
        </g>
      </svg>
      </div>
</body></html>
